<!--
This page will accept a placename and look up data from local storage data (lsdata)
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-place">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>
<app-route
    route="{{route}}"
    pattern="/:name"
    data="{{routeData}}"></app-route>


    <div class="card"><h1>{{routeData.name}}</h1>
      <iron-localstorage name="lsdata" value="{{lsdata}}" on-iron-localstorage-load-empty="initializeDefaultRestaurants"></iron-localstorage>
        </dom-module>
    <input value="{{searchString::input}}">

        <paper-listbox>
            <template is="dom-repeat" items="{{lsdata}}" as="restaurant" filter="{{computeFilter(searchString)}}">
                <paper-icon-item>
                    <div item-icon>
                        <img src="images/logo-assets/{{restaurant.logo}}" class="location-logo">
                    </div>
                    <paper-item-body two-line>
                        <div>{{restaurant.name}}
                        </div>
                        <div secondary>
                            <template is="dom-repeat" items="{{restaurant.menu}}" as="menu">
                                <br> {{menu.item}} | {{menu.isFav}}  <button on-click="toggleFav">Order</button>

                            </template>
                        </div>
                    </paper-item-body>
                    <div class="content-icon">
                        <paper-checkbox checked="{{restaurant.isFav::change}}" bind-value="{{restaurant.isFav}}">
                            <!-- Label start -->
                            <template is="dom-if" if="{{restaurant.isFav}}">
                                <paper-icon-button icon="favorite" alt="favourite this!">
                                </paper-icon-button>
                            </template>
                            <template is="dom-if" if="{{!restaurant.isFav}}">
                                <paper-icon-button icon="favorite-border" alt="favourite this!">
                                </paper-icon-button>
                            </template>
                            <!-- label end -->
                        </paper-checkbox>
                    </div>
                </paper-icon-item>
            </template>
    </template>
    </paper-listbox>

  <script>
    Polymer({
      is: 'my-place',
        properties: {
            lsdata: {
                type: Object
            }
        },
        toggleFav: function(e) {
        var model = e.model;
        var isFavValue = model.get('menu.isFav');

        if(isFavValue == true){
            model.set('menu.isFav', false);    
        }else{
            model.set('menu.isFav', true);
        }

        
      },
       computeFilter: function(string) {
        if (!string) {
          // set filter to null to disable filtering
          return null;
        } else {
          // return a filter function for the current search string
          string = string.toLowerCase();
          return function(employee) {
            var first = employee.name.toLowerCase();
            var last = employee.name.toLowerCase();
            return (first.indexOf(string) != -1 ||
                last.indexOf(string) != -1);
          };
        }
      },

        ready: function() {

            // Retrieve the object from storage
            retrievedObject = localStorage.getItem('lsdata');

            console.log('retrievedObject: ', JSON.parse(retrievedObject));

        },
    });
  </script>
</dom-module>
